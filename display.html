<div class="qtext">
  <?php echo $questiontext; ?>
</div>

<div class="ablock clearfix">
  <div class="prompt">
    <?php echo get_string("answer", "quiz").': '; ?>
  </div>

  <div class="shortanswer"> <!--workaround so that regexp inherits from shortanswer CSS class formatting -->
  <div class="answer">
    <input type="text" class="<?php echo $class; ?>" <?php echo "$readonly $inputname $value"; ?> size="80" />&nbsp;
  <?php echo $feedbackimg; ?>
  <?php 
  // only print Hint button if all these conditions are met (readonly is set on Review page, where we do not want Hint button displayed)
  // and we do not need the Hint button when question has been correctly answered (grade > 0)
  if ($question->options->usehint && ($cmoptions->optionflags == QUESTION_ADAPTIVE) && !$readonly && $state->raw_grade == 0) {      
    $p = get_string("hintpenalty", "qtype_regexp", number_format($question->penalty, 2, '.', ''));
        $q = 'resp'.$question->id.'_';
        $q2 = $q.'submit';
        $hint = get_string("hint", "qtype_regexp");
        echo('<input  id ='.$q.' type="submit" name='.$q2.' value='.$hint.' title='.$p.' onclick="submittheform(this.id)" style="width:auto;">');
    }  
    ?>
  </div>
  </div>
  <?php if ($feedback) { ?>
    <div class="feedback">
      <?php echo $feedback ?>
    </div>
  <?php } ?>
  </div>
  <?php $this->print_question_submit_buttons($question, $state, $cmoptions, $options); echo'<p>&nbsp;</p>'; ?>
<?php if ($correctanswer) { ?>
    <div class="correctness correct">
    <?php echo get_string('correctanswer', 'quiz').': '. $correctanswer; ?>
  </div> 
<?php } ?>
<!--js script for showing / hiding regexp generated alternative sentences (for teacher only)-->
<?php 
$show = get_string("showalternate", "qtype_regexp");
$hide = get_string("hidealternate", "qtype_regexp");
echo ("<script>
function showdiv(id,thisbutton) {
if (document.getElementById(id).style.display == 'none') {
        document.getElementById(id).style.display = 'block'
        thisbutton.value = '".$hide."'
    } else {
        document.getElementById(id).style.display = 'none'
        thisbutton.value = '".$show."'
    }
    return;
}
function submittheform (myid) {
    a = document.forms[0].action;
    if (a.indexOf('preview.php')!=-1) {
        document.forms[0].name = 'responseform';
    }
    a = document.getElementsByName(myid)[0].value;
    // add to student's response an invisible tab character to mean that Hint has been asked for
    document.getElementsByName(myid)[0].value = a + '\t';
    document.forms[1].submit();
}
</script>");
 ?>